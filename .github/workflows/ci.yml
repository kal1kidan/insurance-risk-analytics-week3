name: CI/CD Pipeline


on:
push:
branches: ["main"]
pull_request:
branches: ["main"]


jobs:
build:
runs-on: ubuntu-latest


steps:
- name: Checkout code
uses: actions/checkout@v4


- name: Set up Python
uses: actions/setup-python@v5
with:
python-version: '3.10'


- name: Install dependencies
run: |
python -m pip install --upgrade pip
pip install -r requirements.txt
pip install pytest flake8 black nbconvert nbformat dvc


- name: Lint with flake8
run: flake8 src --max-line-length=88 || exit 1


- name: Check formatting with black
run: black --check src || exit 1


- name: Run tests
run: pytest -q tests || exit 1


- name: Validate Jupyter notebooks
run: |
for nb in notebooks/*.ipynb; do
jupyter nbconvert --execute --to notebook --inplace "$nb" || exit 1
done


- name: Validate DVC pipeline
run: |
dvc repro --dry || exit 1